<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coffebuck | My Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
    </style>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D7T7GX0GNV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-D7T7GX0GNV');
    </script>
</head>

<body class="bg-[var(--bg)] text-[var(--text)]">

    <!-- NAVBAR -->
    <header class="fixed top-0 w-full bg-white/95 backdrop-blur shadow z-50">
        <nav class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <img src="assets/images/coffebuck_logo.png" alt="Coffebuck Logo" class="w-12 h-12 object-contain">
                <span class="text-2xl font-semibold text-[var(--brand)]">Coffebuck</span>
            </div>

            <ul class="hidden md:flex space-x-8 text-lg">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="menu.html" class="nav-link">Menu</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="store-locator.html" class="nav-link">Store Locator</a></li>
                <li><a href="payment.html" class="nav-link">Payment</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>

            <!-- Cart (desktop) -->
            <a href="payment.html" class="hidden md:flex items-center space-x-2">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 6h15l-1.5 9h-12L6 6z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <circle cx="10" cy="20" r="1" fill="currentColor" />
                    <circle cx="18" cy="20" r="1" fill="currentColor" />
                </svg>
                <span id="cart-count" class="cart-badge">0</span>
            </a>

            <div id="user-area" class="ml-4"></div>

            <!-- Mobile toggle -->
            <button id="nav-toggle" class="md:hidden p-2 rounded-lg focus:outline-none" aria-label="Toggle menu">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
        </nav>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-100">
            <ul class="flex flex-col px-6 py-4 space-y-3">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="menu.html" class="nav-link">Menu</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="store-locator.html" class="nav-link">Store Locator</a></li>
                <li><a href="payment.html" class="nav-link">Payment</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>
        </div>
    </header>

    <!-- PAGE HEADER -->
    <section class="pt-28 pb-12 text-center" style="background:var(--primary); color:white;">
        <h1 class="text-5xl font-bold mb-4">My Profile</h1>
        <p class="text-lg max-w-2xl mx-auto">Manage your account and view your order history</p>
    </section>

    <!-- PROFILE CONTENT -->
    <section class="max-w-7xl mx-auto px-6 py-16">
        <div class="grid md:grid-cols-3 gap-8">

            <!-- Left: User Info Card -->
            <div class="md:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg p-8 sticky top-32">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 mx-auto mb-4 rounded-full"
                            style="background: linear-gradient(135deg, var(--brand), var(--primary)); display:flex; align-items:center; justify-content:center;">
                            <span class="text-4xl font-bold text-white" id="profile-avatar">C</span>
                        </div>
                        <h2 id="profile-username" class="text-2xl font-bold mb-1">Username</h2>
                        <p id="profile-email" class="text-gray-600 text-sm break-words">user@email.com</p>
                    </div>

                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="font-semibold text-[var(--primary)] mb-4">Account Stats</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Total Orders</span>
                                <span id="stats-orders" class="font-bold text-[var(--brand)]">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Total Spent</span>
                                <span id="stats-spent" class="font-bold text-[var(--primary)]">₹ 0.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Member Since</span>
                                <span id="stats-joined" class="font-bold text-sm">Today</span>
                            </div>
                        </div>
                    </div>

                    <button onclick="handleLogout()" class="w-full btn-primary mt-8">Logout</button>
                </div>
            </div>

            <!-- Right: Order History -->
            <div class="md:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h2 class="text-3xl font-bold mb-6 text-[var(--primary)]">Order History</h2>

                    <div id="orders-container">
                        <p class="text-gray-600 text-center py-12">No orders yet. <a href="menu.html"
                                class="text-[var(--brand)] font-semibold">Start ordering</a> your favorite brews!</p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- FOOTER -->
    <footer class="text-white py-10 text-center">
        <p class="text-lg mb-3">Coffebuck © 2025</p>
        <p class="text-sm">Crafted with passion and flavor. Inspired by cafe culture worldwide.</p>
    </footer>

    <script src="assets/js/auth-client.js"></script>
    <script src="assets/js/chatbot.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        // Require authentication
        var currentUser = null;
        document.addEventListener('DOMContentLoaded', function () {
            currentUser = window.AuthClient && window.AuthClient.getCurrent ? window.AuthClient.getCurrent() : null;

            if (!currentUser) {
                // Redirect to auth if not logged in
                window.location.href = 'auth.html?mode=login&redirect=' + encodeURIComponent(window.location.pathname);
                return;
            }

            loadProfileData();
        });

        // Load and display profile data
        function loadProfileData() {
            if (!currentUser) return;

            // Update user info
            document.getElementById('profile-username').innerText = currentUser.username || 'User';
            document.getElementById('profile-email').innerText = currentUser.email || '';
            document.getElementById('profile-avatar').innerText = (currentUser.username || 'U').charAt(0).toUpperCase();

            // Calculate stats
            var orders = currentUser.orders || [];
            var totalSpent = 0;
            orders.forEach(function (order) {
                totalSpent += order.total || 0;
            });

            document.getElementById('stats-orders').innerText = orders.length;
            document.getElementById('stats-spent').innerText = '₹ ' + totalSpent.toFixed(2);

            // Member since
            var joinedDate = new Date(parseInt(currentUser.id.split('_')[1]));
            var today = new Date();
            var diffTime = Math.abs(today - joinedDate);
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) {
                document.getElementById('stats-joined').innerText = 'Today';
            } else if (diffDays === 1) {
                document.getElementById('stats-joined').innerText = 'Yesterday';
            } else if (diffDays < 30) {
                document.getElementById('stats-joined').innerText = diffDays + ' days ago';
            } else {
                document.getElementById('stats-joined').innerText = joinedDate.toLocaleDateString();
            }

            // Render orders
            renderOrders(orders);
        }

        // Render orders
        function renderOrders(orders) {
            var container = document.getElementById('orders-container');

            if (!orders || orders.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center py-12">No orders yet. <a href="menu.html" class="text-[var(--brand)] font-semibold">Start ordering</a> your favorite brews!</p>';
                return;
            }

            container.innerHTML = '';
            orders.forEach(function (order, idx) {
                var orderDate = new Date(order.date || Date.now());
                var orderEl = document.createElement('div');
                orderEl.className = 'border border-gray-200 rounded-xl p-6 mb-4 hover:shadow-md transition';

                var itemsList = order.items.map(function (item) {
                    return item.name + ' x' + item.qty;
                }).join(', ');

                orderEl.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-[var(--text)]">Order #${orders.length - idx}</h3>
                            <p class="text-sm text-gray-600">${orderDate.toLocaleDateString()} at ${orderDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                        </div>
                        <span class="bg-[var(--brand)] text-white px-3 py-1 rounded-full text-sm font-medium">Completed</span>
                    </div>
                    <p class="text-gray-700 text-sm mb-3">${itemsList}</p>
                    <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                        <span class="text-gray-600">Total:</span>
                        <span class="font-bold text-[var(--primary)]">₹ ${order.total.toFixed(2)}</span>
                    </div>
                `;

                container.appendChild(orderEl);
            });
        }

        // Logout handler
        function handleLogout() {
            if (window.AuthClient && window.AuthClient.logout) {
                window.AuthClient.logout();
            }
        }
    </script>

</body>

</html>